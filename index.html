<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

</head>
<body>
    <style>

    </style>

    <div class="container-fluid">
        <div class="container">
            <h1>How much time have you lost ?</h1>

            <div class="d-flex">
                <form action="" id="form">
                    <input type="date" id="date" required="required">
                    
                    <input type="submit" id="submit" >
                </form>
            </div>
            
            <div class="row">
                <div class="col ">
                    <div id="date-container d-flex">
                        <div><p><span id="year"></span> Années</p></div>
                        <div><p><span id="day"></span> Jours</p></div>
                        <div><p><span id="hour"></span> Heures</p></div>
                        <div><p><span id="min"></span> Minutes</p></div>
                        <div><p><span id="sec"></span> Secondes</p></div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col ">
                    <div id="date-container d-flex">
                        Ou
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col ">
                    <div id="date-container d-flex">
                        <div><p><span id="msyear"></span> Années</p></div>
                        <div><p><span id="msday"></span> Jours</p></div>
                        <div><p><span id="mshour"></span> Heures</p></div>
                        <div><p><span id="msmin"></span> Minutes</p></div>
                        <div><p><span id="mssec"></span> Secondes</p></div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col ">
                    <form action="" id="steamform">
                        <input type="text" id="steamid" required="required">
                        <input type="submit" id="steamidsubmit" >
                    </form>
                </div>
            </div>
            
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script>
        const API_KEY = '8F234C9A7402FE95766ADF2570FBE004'
        const STEAM_ID = '76561198078481960'

        let form = document.getElementById('form')
        let dateInput = document.getElementById('date')
        let dateContainer = document.getElementById('date-container')

        let steamform = document.getElementById('steamform')

        steamform.addEventListener('submit', (e) => {
            e.preventDefault()

            let steamid = document.getElementById('steamid').value || STEAM_ID
            
            fetch(`https://api.steampowered.com/IPlayerService/GetOwnedGames/v0001/?key=${API_KEY}&steamid=${steamid}&format=json`, {
                mode: 'cors',
                crossorigin: true,
                credentials: 'same-origin',
                headers: {
                    "Origin": "https://localhost"
                }
            })
            .then(function(response) {
                console.log(response)
                return response.json();
            })
            .then(function(json) {
                console.log(json)
                console.log(json.response.games) 
                let timePlayedInSecond = 0
                json.response.games.forEach((el, i) => {
                    console.log(i, el)
                    timePlayedInSecond += el.playtime_forever
                })
                console.log(timePlayedInSecond / 60)
            });
        })

        let divYear = document.getElementById('year')
        let divDay = document.getElementById('day')
        let divHour = document.getElementById('hour')
        let divMin = document.getElementById('min')
        let divSec = document.getElementById('sec')

        let divMSYear = document.getElementById('msyear')
        let divMSDay = document.getElementById('msday')
        let divMSHour = document.getElementById('mshour')
        let divMSMin = document.getElementById('msmin')
        let divMSSec = document.getElementById('mssec')

        let timer = undefined
        let dateInMS = new Date()

        dateInput.valueAsDate = new Date('2001-01-03')
        
        form.addEventListener('submit', (e) => {
            e.preventDefault()
            
            var newDate = new Date(dateInput.value);
            var now = Date.now()
            dateInMS = new Date(now - newDate.getTime())
            calculateLostTime()
            
            if (timer !== undefined) {
                clearInterval(timer)
            }
            timer = setInterval(() => {
                calculateLostTime()
                dateInMS.setTime(dateInMS.getTime() + 1000)
            }, 1000);
        })

        let calculateLostTime = (timeInMS) => {
            let inYears = Math.floor(dateInMS.getTime() / 1000 / 60 / 60 / 24 / 365)
            let inDays = Math.floor(dateInMS.getTime() / 1000 / 60 / 60 / 24)
            let inHours = Math.floor(dateInMS.getTime() / 1000 / 60 / 60)
            let inMinutes = Math.floor(dateInMS.getTime() / 1000 / 60)
            let inSeconds = Math.floor(dateInMS.getTime() / 1000)

            let years = Math.floor(inYears)
            let days = Math.floor(inDays - (years * 365))
            let hours = Math.floor(inHours - (inDays * 24))
            let mins = Math.floor(inMinutes - (inHours * 60))
            let secs = Math.floor(inSeconds - (inMinutes * 60))

            divYear.innerText = years + ' Années'
            divDay.innerText = days + ' Jours'
            divHour.innerText = hours + ' Heures'
            divMin.innerText = mins + ' Minutes'
            divSec.innerText = secs + ' Secondes'

            divMSYear.innerText = inYears + ' Années'
            divMSDay.innerText = inDays + ' Jours'
            divMSHour.innerText = inHours + ' Heures'
            divMSMin.innerText = inMinutes + ' Minutes'
            divMSSec.innerText = inSeconds + ' Secondes'
        }

        const evt = new Event("submit", {});
        form.dispatchEvent(evt);
    </script>
</body>
</html>